<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MindMup Editor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/external/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      #map2 {position:absolute;width:1000; height:1000}
      #map1 {position:absolute;top:0px;left:0px;z-Index:-30;visibility:hidden; }
    </style>
    <link href="/external/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/external/jquery-ui-1.9.2.custom.min.css"/>
    <link rel="stylesheet" type="text/css" href="/css/mindmap.css" /> 

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">Project name</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
           <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
        Edit Map
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li><a id="menuAdd" href="#">New child node</a></li>    
      <li><a id="menuEdit" href="#">Edit node</a></li>    
      <li><a id="menuDelete" href="#">Delete node</a></li>
      <li class="divider"></li>
      <li><a id="menuClear" href="#">Clear Map</a></li>    
    </ul> 
</ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    <div id="map1"></div>
    <div id="map2" class="container" ></div>
   <script src="/mapjs/testtree.js"></script>
  <script src="/external/underscore-1.4.3-min.js"></script>
  <script src="/external/jquery-1.8.3.js"></script>
  <script src="/external/jquery-ui-1.9.2.custom.min.js"></script>
  <script src="/external/bootstrap/js/bootstrap.js"></script>
  <script src="/mapjs/observable.js"></script>
  <script src="/mapjs/content.js"></script>
  <script src="/mapjs/mindmap.js"></script>
    <script>
      var customClasses={ selectedClass:'btn-success', hoverClass:'btn-warning' }
      function addToSelected(){
        content_aggregate.addSubIdea(selectedId,'A cunning plan');
      };
      function jquery_repaint_map(active_content, active_jq_map,onComplete){
        var background_jq_map=$('#map1');
        dom_repaint_entire_map(active_content,background_jq_map);
        $('#map1 .MAP_label').addClass('btn');
        update_map(active_jq_map,visual_to_map(background_jq_map),onComplete);
        active_jq_map.find('.MAP_label').addClass('btn');
      }

      function load_content(json_object){
        var active_content=content(json_object);
        var selectedId=function(){
          return $('#map2').find('.'+customClasses.selectedClass).attr('idea') || active_content.id;
        }
        jquery_repaint_map(active_content,$('#map2'));
        attach_label_listeners($('#map2').find('.MAP_label'), $('#map2'),active_content, customClasses );
        attach_map_listeners(active_content,$('#map2'), jquery_repaint_map,customClasses);
        $('#menuAdd').click(function(){
          active_content.addSubIdea(selectedId(),'A cunning plan');  
        });
        $('#menuEdit').click(function(){
          var selected=selectedId();
          editLabel(
          $('#map2 .MAP_label[idea='+selected+']'),
          function(newValue){
            active_content.updateTitle(selected,newValue);
          }
          );
        });
        $('#menuDelete').click(function(){
          active_content.removeSubIdea(selectedId()); 
        });
        $('#menuClear').click(function(){
          _.each(active_content.ideas, function(idea){ active_content.removeSubIdea(idea.id);})
        });
      }
      $(function(){
        var path= "http://mindmup.s3-website-us-east-1.amazonaws.com/map/default.json";
        $.getJSON( path, function(result) {
          load_content(result);
        });
      });

      </script>
  </body>
</html>
